<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Calculadora de Diâmetro</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
  body { -webkit-tap-highlight-color: transparent; }
  .fade-in { animation: fadeIn .4s ease-in-out; }
  @keyframes fadeIn { from { opacity:0 } to { opacity:1 } }
  .tooltip {
    position:absolute; background:rgba(255,255,255,0.1); backdrop-filter:blur(10px);
    color:#fff; border:1px solid rgba(255,255,255,0.3);
    border-radius:.5rem; padding:.5rem .75rem; font-size:.875rem;
    display:none; pointer-events:none; z-index:50;
  }
</style>
</head>

<body class="min-h-screen flex items-center justify-center p-4 bg-[#0b1a33] text-white font-sans">

<section class="bg-[#12264d] rounded-2xl shadow-2xl p-8 max-w-xl w-full border border-[#1e3a8a]">
  <h1 class="text-3xl font-bold text-sky-400 text-center mb-6">Calculadora de Diâmetro</h1>
  <p class="text-center text-sky-100 mb-6">Preencha os valores e toque em <b>Calcular</b> para obter o diâmetro mínimo das lentes.</p>

  <form id="formDiametro" class="space-y-5"></form>

  <div class="mt-6 flex flex-col items-center space-y-2">
    <button type="button" onclick="calcularDiametro()"
      class="bg-sky-500 hover:bg-sky-600 transition text-white font-semibold py-3 px-6 rounded-xl text-lg w-full">
      <i data-lucide="ruler" class="inline w-5 h-5 mr-2"></i> Calcular
    </button>
    <button type="reset" onclick="resetForm()"
      class="bg-sky-900 hover:bg-sky-800 transition text-sky-200 py-3 px-6 rounded-xl text-lg w-full">
      <i data-lucide="eraser" class="inline w-5 h-5 mr-2"></i> Limpar
    </button>
  </div>

  <div class="mt-8 text-center">
    <p class="text-xl font-semibold text-sky-300 flex items-center justify-center gap-2">
      <i data-lucide="eye" class="w-6 h-6"></i> Diâmetro OD: <span id="resOD">–</span> mm
    </p>
    <p class="text-xl font-semibold text-sky-300 flex items-center justify-center gap-2">
      <i data-lucide="eye" class="w-6 h-6"></i> Diâmetro OE: <span id="resOE">–</span> mm
    </p>
    <p id="alerta" class="hidden text-yellow-400 font-medium mt-3 flex flex-col items-center text-center gap-1 fade-in">
  <i data-lucide="alert-triangle" class="w-6 h-6"></i>
   Atenção: Lentes acabadas<br>
   Positivas = ⌀ 65mm<br>
   Negativas = ⌀ 70mm
  </p>
  </div>
</section>

<div id="tooltip" class="tooltip"></div>

<script>
const campos = [
  { id:"p", label:"P – Ponte", info:"Menor medida entre as lentes (mm)", step:1, min:4, max:30, value:20 },
  { id:"h", label:"H – Horizontal", info:"Maior medida do aro na horizontal (mm)", step:1, min:25, max:90, value:50 },
  { id:"dm", label:"DM – Maior Diâmetro", info:"Maior medida do aro em qualquer sentido (mm)", step:1, min:25, max:90, value:53 },
  { id:"dnpod", label:"DNP OD", info:"Distância Naso-Pupilar do olho direito (mm)", step:0.5, min:20, max:40, value:30 },
  { id:"dnpoe", label:"DNP OE", info:"Distância Naso-Pupilar do olho esquerdo (mm)", step:0.5, min:20, max:40, value:30 },
  { id:"t", label:"T – Tolerância", info:"Margem de erro (mm)", step:1, min:0, max:2, value:1 },
];

const form = document.getElementById("formDiametro");
form.innerHTML = campos.map(c=>`
  <div class="relative">
    <label class="font-semibold flex items-center gap-2 text-sky-200">${c.label}
      <button type="button" onmouseenter="showTip(event,'${c.info}')" onmouseleave="hideTip()"
        class="text-sky-400 hover:text-sky-300"><i data-lucide="info" class="w-5 h-5"></i></button>
    </label>
    <div class="flex items-center mt-2">
      <button type="button" onclick="changeValue('${c.id}', -${c.step})"
        class="bg-sky-800 hover:bg-sky-700 rounded-full w-10 h-10 flex items-center justify-center text-xl font-bold">−</button>
      <input id="${c.id}" type="number" step="${c.step}" min="${c.min}" max="${c.max}" value="${c.value}"
        placeholder="${c.min}–${c.max}"
        class="mx-3 w-full text-center text-lg bg-[#0b1a33] border border-sky-700 rounded-lg p-2 text-white focus:outline-none focus:border-sky-400">
      <button type="button" onclick="changeValue('${c.id}', ${c.step})"
        class="bg-sky-800 hover:bg-sky-700 rounded-full w-10 h-10 flex items-center justify-center text-xl font-bold">+</button>
    </div>
    <p id="error-${c.id}" class="hidden text-red-400 text-sm mt-1 flex items-center gap-1">
      <i data-lucide="alert-circle" class="w-4 h-4"></i> Valor deve estar entre ${c.min} e ${c.max}
    </p>
  </div>
`).join("");

lucide.createIcons();

function showTip(e, text){
  const tip=document.getElementById("tooltip");
  tip.textContent=text;
  tip.style.left=e.clientX+"px";
  tip.style.top=e.clientY+"px";
  tip.style.display="block";
}
function hideTip(){ document.getElementById("tooltip").style.display="none"; }

function changeValue(id, delta){
  const el=document.getElementById(id);
  let v=parseFloat(el.value||0)+delta;
  const min=parseFloat(el.min), max=parseFloat(el.max);
  if(v<min) v=min; if(v>max) v=max;
  el.value=v.toFixed(el.step<1?1:0);
}

function validar(){
  let ok=true;
  campos.forEach(c=>{
    const el=document.getElementById(c.id);
    const err=document.getElementById("error-"+c.id);
    if(el.value<c.min || el.value>c.max){
      err.classList.remove("hidden");
      el.classList.add("border-red-500");
      ok=false;
    }else{
      err.classList.add("hidden");
      el.classList.remove("border-red-500");
    }
  });

  const h=+document.getElementById("h").value;
  const dm=+document.getElementById("dm").value;
  if(h>dm){
    const eh=document.getElementById("error-h");
    eh.innerHTML='<i data-lucide="alert-circle" class="w-4 h-4"></i> H não pode ser maior que DM';
    eh.classList.remove("hidden");
    document.getElementById("h").classList.add("border-red-500");
    lucide.createIcons();
    ok=false;
  }
  return ok;
}

function calcularDiametro(){
  if(!validar()) return;

  // Coleta dos valores
  const p = parseFloat(document.getElementById("p").value);
  const h = parseFloat(document.getElementById("h").value);
  const dm = parseFloat(document.getElementById("dm").value);
  const dnpod = parseFloat(document.getElementById("dnpod").value);
  const dnpoe = parseFloat(document.getElementById("dnpoe").value);
  const t = parseFloat(document.getElementById("t").value);

  // Cálculo do diâmetro
  const diOD = ((p + h + dm) - (dnpod * 2)) + t;
  const diOE = ((p + h + dm) - (dnpoe * 2)) + t;

  // Exibição
  document.getElementById("resOD").textContent = diOD.toFixed(1);
  document.getElementById("resOE").textContent = diOE.toFixed(1);

  const alerta=document.getElementById("alerta");
  if(diOD>65 || diOE>65) alerta.classList.remove("hidden");
  else alerta.classList.add("hidden");
}

function resetForm(){
  form.reset();
  document.querySelectorAll("[id^='error-']").forEach(e=>e.classList.add("hidden"));
  document.getElementById("alerta").classList.add("hidden");
  document.getElementById("resOD").textContent="–";
  document.getElementById("resOE").textContent="–";
}
</script>
</body>
</html>
